# 测试运行指南

## 🎯 快速开始

### 前提条件

- ✅ DevEco Studio 已安装
- ✅ 项目已正确配置
- ✅ 测试设备或模拟器已连接

---

## 🚀 运行测试

### 方法1: 运行所有测试（推荐）

1. 在 DevEco Studio 中打开项目
2. 在项目结构中找到 `entry/ohosTest` 目录
3. 右键点击 `ohosTest` 目录
4. 选择 **Run 'All Tests'**

### 方法2: 运行单个测试套件

1. 展开 `entry/ohosTest/ets/test` 目录
2. 选择要运行的测试文件（如 `UserDAO.test.ets`）
3. 右键点击文件
4. 选择 **Run 'UserDAOTest'**

### 方法3: 运行特定分类的测试

#### 运行所有 DAO 测试
```
右键点击 entry/ohosTest/ets/test/dao 目录
-> Run 'Tests in dao'
```

#### 运行所有 Model 测试
```
右键点击 entry/ohosTest/ets/test/model 目录
-> Run 'Tests in model'
```

#### 运行所有 Page 测试
```
右键点击 entry/ohosTest/ets/test/pages 目录
-> Run 'Tests in pages'
```

---

## 📊 测试结果查看

### 测试窗口

运行测试后，DevEco Studio 会自动打开测试结果窗口，显示：

- ✅ **通过的测试** - 绿色标记
- ❌ **失败的测试** - 红色标记
- ⏭️ **跳过的测试** - 黄色标记

### 测试统计

测试窗口会显示：
- 总测试数
- 通过数量
- 失败数量
- 执行时间

---

## 📝 测试文件清单

### DAO 层测试（6个）

| 文件 | 测试内容 | 状态 |
|------|---------|------|
| `AccountDAO.test.ets` | 账户增删改查 | ✅ |
| `BillDAO.test.ets` | 账单增删改查 | ✅ |
| `BudgetDAO.test.ets` | 预算增删改查 | ✅ |
| `CategoryDAO.test.ets` | 分类增删改查 | ✅ |
| `StatisticsDAO.test.ets` | 统计查询 | ✅ |
| `UserDAO.test.ets` | 用户增删改查 | ✅ |

### Model 层测试（6个）

| 文件 | 测试内容 | 状态 |
|------|---------|------|
| `Account.test.ets` | 账户模型验证 | ✅ |
| `Bill.test.ets` | 账单模型验证 | ✅ |
| `Budget.test.ets` | 预算模型验证 | ✅ |
| `Category.test.ets` | 分类模型验证 | ✅ |
| `Statistics.test.ets` | 统计模型验证 | ✅ |
| `User.test.ets` | 用户模型验证 | ✅ |

### Page 层测试（3个）

| 文件 | 测试内容 | 状态 |
|------|---------|------|
| `AddBillPage.test.ets` | 添加账单页面 | ✅ |
| `CategoryManagementPage.test.ets` | 分类管理页面 | ✅ |
| `IndexPage.test.ets` | 首页 | ✅ |

### Service 层测试（1个）

| 文件 | 测试内容 | 状态 |
|------|---------|------|
| `Transaction.test.ets` | 交易服务 | ✅ |

---

## 🔧 常见问题

### Q1: 测试运行失败，提示数据库初始化错误

**解决方案**:
```typescript
// 确保在 beforeAll 中正确初始化数据库
beforeAll(async () => {
  const ctx = getContext() as common.Context;
  await DatabaseManager.initDatabase(ctx);
});
```

### Q2: 测试之间相互影响

**解决方案**:
- 使用 `beforeEach` 清理测试数据
- 使用事务隔离测试
- 使用唯一的测试数据

```typescript
beforeEach(async () => {
  // 清理测试数据
  await DatabaseManager.clearTestData();
});
```

### Q3: 异步测试超时

**解决方案**:
```typescript
// 增加超时时间（第二个参数，单位：毫秒）
it('long running test', 10000, async () => {
  // 测试代码
});
```

### Q4: 找不到测试设备

**解决方案**:
1. 确保设备已连接并授权
2. 在 DevEco Studio 中选择正确的设备
3. 检查设备是否支持测试框架

---

## 📈 测试最佳实践

### 1. 测试命名

```typescript
// ✅ 好的命名
it('should insert user successfully', 0, async () => {});
it('should throw error when username is empty', 0, async () => {});

// ❌ 不好的命名
it('test1', 0, async () => {});
it('user test', 0, async () => {});
```

### 2. 测试独立性

```typescript
// ✅ 每个测试独立
it('test A', 0, async () => {
  const user = createTestUser();
  // 测试逻辑
});

it('test B', 0, async () => {
  const user = createTestUser();
  // 测试逻辑
});

// ❌ 测试之间有依赖
let sharedUser: User;
it('test A', 0, async () => {
  sharedUser = createTestUser();
});
it('test B', 0, async () => {
  // 依赖 test A 的结果
  expect(sharedUser).not.toBeNull();
});
```

### 3. 断言清晰

```typescript
// ✅ 清晰的断言
expect(user.username).assertEqual('testuser');
expect(users.length).assertEqual(5);

// ❌ 模糊的断言
expect(user).not.toBeNull();
expect(users.length > 0).assertTrue();
```

### 4. 测试覆盖

确保测试覆盖：
- ✅ 正常情况
- ✅ 边界情况
- ✅ 错误情况
- ✅ 异常情况

```typescript
describe('User validation', () => {
  it('should pass with valid data', 0, () => {
    // 正常情况
  });

  it('should fail with empty username', 0, () => {
    // 边界情况
  });

  it('should fail with invalid email format', 0, () => {
    // 错误情况
  });

  it('should handle null values', 0, () => {
    // 异常情况
  });
});
```

---

## 🎓 学习资源

### HarmonyOS 测试文档
- [HarmonyOS 测试框架](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/arkts-unit-test-0000001478061717-V3)
- [Hypium 测试框架](https://gitee.com/openharmony/testfwk_arkxtest)

### 测试框架 API
```typescript
// 测试套件
describe('suite name', () => {});

// 测试用例
it('test name', timeout, async () => {});

// 生命周期钩子
beforeAll(async () => {});    // 所有测试前执行一次
afterAll(async () => {});     // 所有测试后执行一次
beforeEach(async () => {});   // 每个测试前执行
afterEach(async () => {});    // 每个测试后执行

// 断言
expect(value).assertTrue();
expect(value).assertFalse();
expect(value).assertEqual(expected);
expect(value).assertNull();
expect(value).assertUndefined();
```

---

## ✅ 测试检查清单

运行测试前确认：
- [ ] 数据库已正确初始化
- [ ] 测试数据已准备
- [ ] 测试设备已连接
- [ ] 测试环境已配置

运行测试后检查：
- [ ] 所有测试是否通过
- [ ] 是否有失败的测试
- [ ] 测试覆盖率是否足够
- [ ] 是否需要添加新测试

---

## 📞 获取帮助

如果遇到问题：
1. 查看测试错误日志
2. 检查测试文件语法
3. 确认测试环境配置
4. 参考 HarmonyOS 官方文档

---

**文档版本**: v1.0.0  
**最后更新**: 2025-11-11  
**状态**: ✅ 所有测试正常
