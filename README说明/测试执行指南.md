# 测试执行指南 - 功能测试与回归测试

## 📋 文档信息
- **版本**: 1.0.0
- **创建日期**: 2025-11-08
- **适用范围**: 功能测试、回归测试、验收测试

---

## 🎯 测试目标

### 本次测试目标
1. ✅ 验证所有代码修改后的功能正常性
2. ✅ 确保数据库层修改没有破坏现有功能
3. ✅ 验证 Model 字段命名统一后的兼容性
4. ✅ 测试页面功能的完整性

### 测试范围
- **Model 层**: 6个模型类
- **DAO 层**: 6个数据访问类 + DatabaseManager
- **页面层**: 3个页面 (Index, AddBill, CategoryManagement)
- **数据库**: 7张表的 CRUD 操作

.............................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................
---

## 📝 测试前准备

### 1. 环境检查

```bash
# 检查 DevEco Studio 版本
# 要求: DevEco Studio 3.1+

# 检查 HarmonyOS SDK
# 要求: API 9+

# 检查测试设备/模拟器
hdc list targets
```

### 2. 安装依赖

```bash
# 在项目根目录执行
ohpm install
```

### 3. 清理旧数据

```bash
# 卸载旧版本应用（如果存在）
hdc uninstall com.example.healthydiet

# 清理数据库
hdc shell rm -rf /data/app/el2/100/database/com.example.healthydiet/
```

### 4. 编译项目

```bash
# 编译主应用
hvigorw assembleHap

# 编译测试模块
hvigorw assembleTest
```

---

## 🧪 测试执行步骤

### 阶段 1: 单元测试 (Model 层)

#### 测试目标
验证所有 Model 类的基本功能和字段命名统一性

#### 执行步骤

**1. 运行 Model 测试**

在 DevEco Studio 中:
1. 打开 `entry/ohosTest/ets/test/model/` 目录
2. 右键点击 `model` 文件夹
3. 选择 "Run 'Tests in model'"

或使用命令行:
```bash
hdc shell aa test -b com.example.healthydiet -m ohosTest -s class AccountTest -s unittest OpenHarmonyTestRunner
```

**2. 验证点**

| 测试项 | 验证内容 | 预期结果 |
|--------|---------|---------|
| Account.validate() | 数据验证逻辑 | ✅ 通过 |
| Account.toJSON() | 序列化使用 isDeleted | ✅ 通过 |
| Account.fromJSON() | 反序列化使用 isDeleted | ✅ 通过 |
| Bill.validate() | 数据验证逻辑 | ✅ 通过 |
| User.validate() | 数据验证逻辑 | ✅ 通过 |
| Category.validate() | 数据验证逻辑 | ✅ 通过 |
| Budget.validate() | 数据验证逻辑 | ✅ 通过 |
| Statistics.validate() | 数据验证逻辑 | ✅ 通过 |

**3. 检查测试结果**

```
✅ Account.test.ets - 7 tests passed
✅ Bill.test.ets - 6 tests passed
✅ User.test.ets - 5 tests passed
✅ Category.test.ets - 6 tests passed
✅ Budget.test.ets - 5 tests passed
✅ Statistics.test.ets - 8 tests passed

Total: 37 tests
Passed: 37
Failed: 0
```

---

### 阶段 2: 集成测试 (DAO 层)

#### 测试目标
验证数据库操作和 DatabaseManager 的正确性

#### 执行步骤

**1. 运行 DAO 测试**

```bash
# 运行所有 DAO 测试
hdc shell aa test -b com.example.healthydiet -m ohosTest -s class AccountDAOTest -s unittest OpenHarmonyTestRunner
```

**2. 关键验证点**

| 测试项 | 验证内容 | 预期结果 |
|--------|---------|---------|
| DatabaseManager.initDatabase() | 数据库初始化 | ✅ 成功 |
| 外键约束 | bills → accounts | ✅ 约束生效 |
| 外键约束 | bills → categories | ✅ 约束生效 |
| 外键约束 | budgets → users | ✅ 约束生效 |
| AccountDAO.insert() | 插入数据 | ✅ 成功 |
| AccountDAO.getById() | 查询数据 | ✅ 返回正确 |
| AccountDAO.update() | 更新数据 | ✅ 成功 |
| AccountDAO.softDelete() | 软删除 | ✅ is_deleted=1 |
| BillDAO.getBillsByFilters() | 筛选查询 | ✅ 返回正确 |

**3. 数据库完整性测试**

```typescript
// 测试外键约束
it('should fail when inserting bill with invalid account', 0, async () => {
  const bill = new Bill(0, 999, 1, 100, '', '2025-11-01', 'expense', '', '', 0);
  try {
    await BillDAO.insert(bill);
    expect(false).assertTrue(); // 不应该执行到这里
  } catch (error) {
    expect(error.message).assertContain('Account');
    console.info('✅ 外键约束验证通过');
  }
});
```

**4. 检查测试结果**

```
✅ AccountDAO.test.ets - 8 tests passed
✅ BillDAO.test.ets - 10 tests passed
✅ UserDAO.test.ets - 7 tests passed
✅ CategoryDAO.test.ets - 9 tests passed
✅ BudgetDAO.test.ets - 6 tests passed
✅ StatisticsDAO.test.ets - 8 tests passed

Total: 48 tests
Passed: 48
Failed: 0
```

---

### 阶段 3: 页面功能测试

#### 测试目标
验证页面加载、渲染和用户交互

#### 3.1 Index 页面测试

**手动测试步骤**:

1. **启动应用**
   ```bash
   hdc install -r entry-default-signed.hap
   hdc shell aa start -a EntryAbility -b com.example.healthydiet
   ```

2. **测试月份选择器**
   - [ ] 点击月份选择器
   - [ ] 选择不同月份
   - [ ] 验证账单列表更新
   - [ ] 验证日期显示正确

3. **测试分类筛选器**
   - [ ] 点击分类下拉框
   - [ ] 选择"所有分类"
   - [ ] 选择特定分类
   - [ ] 验证账单列表筛选正确

4. **测试账单列表**
   - [ ] 验证账单显示正确
   - [ ] 验证支出显示红色负数
   - [ ] 验证收入显示绿色正数
   - [ ] 验证备注显示

5. **测试按钮功能**
   - [ ] 点击"管理分类"按钮
   - [ ] 验证跳转到分类管理页面
   - [ ] 返回首页
   - [ ] 点击"记一笔"按钮
   - [ ] 验证跳转到添加账单页面

**验证清单**:
```
✅ 页面加载成功
✅ 月份选择器工作正常
✅ 分类筛选器工作正常
✅ 账单列表显示正确
✅ 按钮跳转正常
✅ 无崩溃或错误
```

#### 3.2 AddBill 页面测试

**手动测试步骤**:

1. **测试支出/收入切换**
   - [ ] 点击"支出"标签
   - [ ] 验证分类列表更新为支出分类
   - [ ] 点击"收入"标签
   - [ ] 验证分类列表更新为收入分类

2. **测试金额输入**
   - [ ] 输入有效金额 (如 100.50)
   - [ ] 输入无效金额 (如 -100)
   - [ ] 输入非数字
   - [ ] 验证输入验证

3. **测试分类选择**
   - [ ] 点击分类下拉框
   - [ ] 选择一个分类
   - [ ] 验证选择生效

4. **测试日期选择**
   - [ ] 点击日期选择器
   - [ ] 选择不同日期
   - [ ] 验证日期显示

5. **测试备注输入**
   - [ ] 输入备注文本
   - [ ] 验证文本显示

6. **测试保存功能**
   - [ ] 填写完整信息
   - [ ] 点击"保存"按钮
   - [ ] 验证 Toast 提示"保存成功"
   - [ ] 验证返回首页
   - [ ] 验证新账单显示在列表中

**验证清单**:
```
✅ 支出/收入切换正常
✅ 金额输入验证正确
✅ 分类选择正常
✅ 日期选择正常
✅ 备注输入正常
✅ 保存功能正常
✅ 数据持久化成功
```

#### 3.3 CategoryManagement 页面测试

**手动测试步骤**:

1. **测试分类列表显示**
   - [ ] 验证分类列表加载
   - [ ] 验证分类图标显示
   - [ ] 验证分类颜色显示

2. **测试分类添加**
   - [ ] 点击"添加分类"按钮
   - [ ] 输入分类名称
   - [ ] 选择分类类型
   - [ ] 选择图标和颜色
   - [ ] 保存
   - [ ] 验证新分类显示

3. **测试分类编辑**
   - [ ] 点击某个分类
   - [ ] 修改分类信息
   - [ ] 保存
   - [ ] 验证修改生效

4. **测试分类删除**
   - [ ] 点击删除按钮
   - [ ] 确认删除
   - [ ] 验证分类被删除

**验证清单**:
```
✅ 分类列表显示正常
✅ 添加分类功能正常
✅ 编辑分类功能正常
✅ 删除分类功能正常
```

---

### 阶段 4: 端到端测试

#### 测试场景 1: 完整的记账流程

**步骤**:
1. 启动应用
2. 点击"记一笔"
3. 选择"支出"
4. 输入金额: 50.00
5. 选择分类: "餐饮"
6. 选择日期: 今天
7. 输入备注: "午餐"
8. 点击"保存"
9. 返回首页
10. 验证新账单显示在列表中

**预期结果**:
```
✅ 账单成功添加
✅ 金额显示: -50.00 (红色)
✅ 备注显示: "午餐"
✅ 日期显示: 今天
```

#### 测试场景 2: 筛选和查看账单

**步骤**:
1. 在首页
2. 点击月份选择器
3. 选择上个月
4. 验证账单列表更新
5. 点击分类筛选器
6. 选择"餐饮"
7. 验证只显示餐饮类账单

**预期结果**:
```
✅ 月份筛选正常
✅ 分类筛选正常
✅ 数据显示正确
```

#### 测试场景 3: 管理分类

**步骤**:
1. 在首页点击"管理分类"
2. 点击"添加分类"
3. 输入名称: "交通"
4. 选择类型: "支出"
5. 选择图标: 🚗
6. 保存
7. 返回首页
8. 点击"记一笔"
9. 验证新分类出现在列表中

**预期结果**:
```
✅ 分类添加成功
✅ 新分类可用于记账
```

---

## 🔍 回归测试清单

### 核心功能回归

| 功能模块 | 测试项 | 状态 |
|---------|--------|------|
| 数据库 | 初始化 | ⬜ |
| 数据库 | 表创建 | ⬜ |
| 数据库 | 外键约束 | ⬜ |
| Model | 数据验证 | ⬜ |
| Model | 序列化/反序列化 | ⬜ |
| DAO | 插入操作 | ⬜ |
| DAO | 查询操作 | ⬜ |
| DAO | 更新操作 | ⬜ |
| DAO | 删除操作 | ⬜ |
| DAO | 软删除 | ⬜ |
| 页面 | 首页加载 | ⬜ |
| 页面 | 添加账单 | ⬜ |
| 页面 | 分类管理 | ⬜ |
| 交互 | 月份筛选 | ⬜ |
| 交互 | 分类筛选 | ⬜ |
| 交互 | 页面跳转 | ⬜ |

### 修改影响回归

| 修改内容 | 影响范围 | 回归测试 | 状态 |
|---------|---------|---------|------|
| DatabaseManager | 所有 DAO | 数据库初始化测试 | ⬜ |
| 外键约束 | Bill, Budget | 外键验证测试 | ⬜ |
| isDeleted 命名 | 所有 Model | 序列化测试 | ⬜ |
| BillDAO.getBillsByFilters | Index 页面 | 筛选功能测试 | ⬜ |
| Bill 构造函数 | AddBill 页面 | 添加账单测试 | ⬜ |

---

## 📊 测试报告模板

### 测试执行报告

**测试信息**:
- 测试日期: ___________
- 测试人员: ___________
- 测试版本: ___________
- 测试环境: ___________

**测试结果统计**:
```
总测试用例数: _____
通过: _____
失败: _____
阻塞: _____
跳过: _____

通过率: _____%
```

**详细结果**:

| 模块 | 用例数 | 通过 | 失败 | 备注 |
|------|--------|------|------|------|
| Model 层 | 37 | ___ | ___ | |
| DAO 层 | 48 | ___ | ___ | |
| 页面层 | 15 | ___ | ___ | |
| 端到端 | 10 | ___ | ___ | |

**发现的问题**:

| 问题ID | 严重程度 | 问题描述 | 状态 |
|--------|---------|---------|------|
| BUG-001 | 高 | | |
| BUG-002 | 中 | | |

**测试结论**:
- [ ] 通过，可以发布
- [ ] 有问题，需要修复
- [ ] 阻塞，无法继续测试

---

## 🐛 问题追踪

### 问题报告模板

```markdown
## 问题ID: BUG-XXX

**严重程度**: [高/中/低]

**问题描述**:
简要描述问题

**复现步骤**:
1. 步骤1
2. 步骤2
3. 步骤3

**预期结果**:
应该发生什么

**实际结果**:
实际发生了什么

**环境信息**:
- 设备: 
- 系统版本: 
- 应用版本: 

**截图/日志**:
附加截图或日志

**影响范围**:
影响哪些功能

**建议修复方案**:
如何修复
```

---

## ✅ 测试完成标准

### 单元测试完成标准
- [ ] 所有 Model 测试通过
- [ ] 所有 DAO 测试通过
- [ ] 测试覆盖率 > 80%
- [ ] 无严重 bug

### 集成测试完成标准
- [ ] 数据库操作正常
- [ ] 外键约束生效
- [ ] 数据持久化正常
- [ ] 无数据丢失

### 功能测试完成标准
- [ ] 所有页面加载正常
- [ ] 所有交互功能正常
- [ ] 数据显示正确
- [ ] 无崩溃或卡顿

### 回归测试完成标准
- [ ] 核心功能无退化
- [ ] 修改影响范围可控
- [ ] 无新增严重 bug
- [ ] 性能无明显下降

---

## 📞 支持与帮助

### 遇到问题时

1. **查看日志**
   ```bash
   hdc hilog | grep "testTag"
   hdc hilog | grep "ERROR"
   ```

2. **检查数据库**
   ```bash
   hdc shell
   cd /data/app/el2/100/database/com.example.healthydiet/
   ls -la
   ```

3. **重置环境**
   ```bash
   hdc uninstall com.example.healthydiet
   hdc shell rm -rf /data/app/el2/100/database/com.example.healthydiet/
   hdc install -r entry-default-signed.hap
   ```

4. **联系开发团队**
   - 提供详细的问题描述
   - 附上日志和截图
   - 说明复现步骤

---

## 📚 相关文档

- [测试技术文档.md](./测试技术文档.md) - 详细的测试技术说明
- [修改完成总结.md](./修改完成总结.md) - 代码修改总结
- [框架测试文档.md](./框架测试文档.md) - 框架问题分析

---

**祝测试顺利！** 🎉
