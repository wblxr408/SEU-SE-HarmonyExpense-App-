# å¯¼å‡ºå¤‡ä»½åŠŸèƒ½ - å¿«é€Ÿå‚è€ƒ

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

### 1ï¸âƒ£ å¯¼å…¥æ¨¡å—

```typescript
import { ExportService, ImportService, ExportOptions } from '../service/export';
```

### 2ï¸âƒ£ å¯¼å‡ºæ•°æ®

```typescript
// æ— åŠ å¯†
const filePath = await ExportService.exportUserData(userId, {
  format: 'json',
  encrypt: false,
  includeDeleted: false
});

// åŠ å¯†
const encryptedPath = await ExportService.exportUserData(userId, {
  format: 'json',
  encrypt: true,
  password: 'YourPassword123!',
  includeDeleted: false
});
```

### 3ï¸âƒ£ å¯¼å…¥æ•°æ®

```typescript
// æ— åŠ å¯†
const result = await ImportService.importUserData(filePath);

// åŠ å¯†
const result = await ImportService.importUserData(encryptedPath, 'YourPassword123!');

// æŸ¥çœ‹ç»“æœ
console.log('æˆåŠŸ:', result.success);
console.log('å¯¼å…¥:', result.imported);
console.log('é”™è¯¯:', result.errors);
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
entry/src/main/ets/service/export/
â”œâ”€â”€ index.ets                    # ç»Ÿä¸€å…¥å£ â­
â”œâ”€â”€ types/
â”‚   â””â”€â”€ ExportTypes.ets         # ç±»å‹å®šä¹‰
â”œâ”€â”€ EncryptionModule.ets        # åŠ å¯†æ¨¡å—
â”œâ”€â”€ FileHelper.ets              # æ–‡ä»¶æ“ä½œ
â”œâ”€â”€ ChecksumHelper.ets          # æ ¡éªŒå’Œ
â”œâ”€â”€ ExportService.ets           # å¯¼å‡ºæœåŠ¡ â­
â””â”€â”€ ImportService.ets           # å¯¼å…¥æœåŠ¡ â­
```

---

## ğŸ”‘ æ ¸å¿ƒ API

### ExportService.exportUserData()
```typescript
static async exportUserData(
  userId: number,
  options: ExportOptions
): Promise<string>
```

### ImportService.importUserData()
```typescript
static async importUserData(
  filePath: string,
  password?: string,
  options?: ImportOptions
): Promise<ImportResult>
```

---

## ğŸ“Š æ•°æ®ç±»å‹

### ExportOptions
```typescript
{
  format: 'json',           // æ ¼å¼
  encrypt: boolean,         // æ˜¯å¦åŠ å¯†
  password?: string,        // å¯†ç ï¼ˆåŠ å¯†æ—¶å¿…éœ€ï¼‰
  includeDeleted: boolean   // æ˜¯å¦åŒ…å«å·²åˆ é™¤æ•°æ®
}
```

### ImportResult
```typescript
{
  success: boolean,         // æ˜¯å¦æˆåŠŸ
  imported: {               // å¯¼å…¥ç»Ÿè®¡
    users: number,
    accounts: number,
    categories: number,
    bills: number,
    budgets: number,
    tags: number
  },
  errors: string[]          // é”™è¯¯åˆ—è¡¨
}
```

---

## âš ï¸ é”™è¯¯å¤„ç†

```typescript
import { ExportError, ExportErrorCode } from '../service/export';

try {
  const filePath = await ExportService.exportUserData(userId, options);
} catch (error) {
  if (error instanceof ExportError) {
    switch (error.code) {
      case ExportErrorCode.DATABASE_ERROR:
        console.error('æ•°æ®åº“é”™è¯¯');
        break;
      case ExportErrorCode.ENCRYPTION_ERROR:
        console.error('åŠ å¯†é”™è¯¯');
        break;
      case ExportErrorCode.FILE_SYSTEM_ERROR:
        console.error('æ–‡ä»¶ç³»ç»Ÿé”™è¯¯');
        break;
      case ExportErrorCode.VALIDATION_ERROR:
        console.error('éªŒè¯é”™è¯¯');
        break;
    }
  }
}
```

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- âœ… **AES-256-GCM** åŠ å¯†
- âœ… **PBKDF2** å¯†é’¥æ´¾ç”Ÿï¼ˆ100,000 æ¬¡è¿­ä»£ï¼‰
- âœ… **SHA-256** æ•°æ®å®Œæ•´æ€§æ ¡éªŒ
- âœ… **é˜²ç¯¡æ”¹** GCM è®¤è¯æ ‡ç­¾

---

## ğŸ“ æ–‡ä»¶å‘½å

- æ— åŠ å¯†: `backup_ç”¨æˆ·ID_æ—¶é—´æˆ³.json`
- åŠ å¯†: `backup_ç”¨æˆ·ID_æ—¶é—´æˆ³.enc`

ç¤ºä¾‹: `backup_1_1699776000000.json`

---

## ğŸ¯ å¸¸ç”¨åœºæ™¯

### åœºæ™¯1: ç”¨æˆ·æ‰‹åŠ¨å¤‡ä»½
```typescript
const filePath = await ExportService.exportUserData(userId, {
  format: 'json',
  encrypt: true,
  password: userInputPassword,
  includeDeleted: false
});
// æç¤ºç”¨æˆ·å¤‡ä»½æˆåŠŸ
```

### åœºæ™¯2: æ¢å¤æ•°æ®
```typescript
const result = await ImportService.importUserData(
  selectedFilePath,
  userInputPassword
);
if (result.success) {
  // åˆ·æ–°UIï¼Œæ˜¾ç¤ºå¯¼å…¥æˆåŠŸ
}
```

### åœºæ™¯3: å®šæœŸè‡ªåŠ¨å¤‡ä»½
```typescript
// æ¯å‘¨è‡ªåŠ¨å¤‡ä»½
setInterval(async () => {
  await ExportService.exportUserData(userId, {
    format: 'json',
    encrypt: true,
    password: getStoredPassword(),
    includeDeleted: false
  });
}, 7 * 24 * 60 * 60 * 1000);
```

---

## ğŸ“š æ›´å¤šä¿¡æ¯

- **è¯¦ç»†ç¤ºä¾‹** â†’ `å¯¼å‡ºå¤‡ä»½ä½¿ç”¨ç¤ºä¾‹.md`
- **å®Œæ•´æ–‡æ¡£** â†’ `å¯¼å‡ºå¤‡ä»½åŠŸèƒ½å®Œæˆæ€»ç»“.md`
- **äº¤ä»˜æ¸…å•** â†’ `å¯¼å‡ºå¤‡ä»½åŠŸèƒ½-æœ€ç»ˆäº¤ä»˜æ¸…å•.md`

---

## âœ… æ£€æŸ¥æ¸…å•

ä½¿ç”¨å‰ç¡®è®¤ï¼š
- [ ] å·²å¯¼å…¥æ­£ç¡®çš„æ¨¡å—
- [ ] å·²é…ç½® ExportOptions
- [ ] åŠ å¯†æ—¶å·²æä¾›å¯†ç 
- [ ] å·²å¤„ç†å¯èƒ½çš„é”™è¯¯
- [ ] å·²æµ‹è¯•å¯¼å‡ºå¯¼å…¥æµç¨‹

---

**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°**: 2025-11-11  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
